(()=>{var e={16:()=>{$(document).ready((function(){var e=$("#message"),t=new URLSearchParams(window.location.search).get("token");t?$("#resetPasswordForm").on("submit",(function(a){a.preventDefault();var o=$("#password").val(),n=$("#confirmPassword").val();e.removeClass("error-message success-message"),o===n?o.length<8?e.text("Password must be at least 8 characters long!").addClass("error-message"):$.ajax({url:"http://localhost:8000/api/auth/reset-password/".concat(t),method:"POST",contentType:"application/json",data:JSON.stringify({password:o}),success:function(t){e.text("Password reset successful! Redirecting to login...").addClass("success-message"),$("#resetPasswordForm")[0].reset(),setTimeout((function(){window.location.href="login.html"}),3e3)},error:function(t){var a;e.text((null===(a=t.responseJSON)||void 0===a?void 0:a.detail)||"An error occurred. Please try again.").addClass("error-message")}}):e.text("Passwords do not match!").addClass("error-message")})):e.text("Invalid reset link. Please request a new password reset.").addClass("error-message")}))},137:()=>{var e=1;function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=localStorage.getItem("token"),o=$("#userSearch").val(),i=$("#roleFilter").val(),r=$("#statusFilter").val(),s="http://localhost:8000/api/admin/users/list/?skip=".concat(10*(e-1),"&limit=").concat(10);o&&(s+="&search=".concat(encodeURIComponent(o))),i&&"all"!==i&&(s+="&role=".concat(encodeURIComponent(i))),r&&"all"!==r&&(s+="&is_active=".concat("active"===r)),$.ajax({url:s,headers:{Authorization:"Bearer ".concat(t)},method:"GET",success:function(e){var t,o;t=e.users,(o=$("#userTableBody")).empty(),t.forEach((function(e){var t=$("<tr>");t.append("<td>".concat(e.name,"</td>")),t.append("<td>".concat(e.email,"</td>")),t.append("<td>".concat(e.role,"</td>")),t.append('<td><span class="status-badge '.concat(e.is_active?"active":"inactive",'">').concat(e.is_active?"Active":"Inactive","</span></td>")),t.append('<td><span class="verification-badge '.concat(e.is_verified?"verified":"unverified",'">').concat(e.is_verified?"Verified":"Unverified","</span></td>")),t.append('\n<td>\n                <button class="btn-edit" onclick="editUser('.concat(e.id,')">\n                    <i data-lucide="edit"></i>\n                    Edit\n                </button>\n                <button class="btn-delete" onclick="deleteUser(').concat(e.id,')">\n                    <i data-lucide="trash-2"></i>\n                    Delete\n                </button>\n                ').concat(e.is_verified?"":'<button class="btn-verify" onclick="verifyUser('.concat(e.id,')">Verify</button>'),"\n            </td>\n        ")),o.append(t)})),lucide.createIcons(),a(e.total)},error:function(e){var t;n((null===(t=e.responseJSON)||void 0===t?void 0:t.detail)||"Failed to load users","error")}})}function a(t){var a=Math.ceil(t/10);$("#pageInfo").text("Page ".concat(e," of ").concat(a)),$("#prevPage").prop("disabled",e<=1),$("#nextPage").prop("disabled",e>=a)}function o(){var t=localStorage.getItem("token"),o=$("#auditDateFrom").val(),i=$("#auditDateTo").val(),r=$("#auditActionFilter").val(),s=new URLSearchParams({skip:10*(e-1),limit:10,include_names:!0});o&&s.append("from_date",o),i&&s.append("to_date",i),r&&s.append("action",r),$.ajax({url:"http://localhost:8000/api/audit-logs?".concat(s.toString()),headers:{Authorization:"Bearer ".concat(t)},method:"GET",success:function(e){var t,o;t=e,(o=$("#auditTable tbody")).empty(),t&&0!==t.length?t.forEach((function(e){var t=new Date(e.timestamp).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}),a=e.action.split("_").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()})).join(" "),n=function(e,t){switch(e){case"UPDATE_USER":return function(e){try{var t=[];if(e.includes("role")){var a=e.match(/role to (\w+(-\w+)*)/);if(a){var o=a[1].split("-").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join(" ");t.push("Role changed to ".concat(o))}}if(e.includes("status")){var n=e.includes("activated")?"Activated":"Deactivated";t.push("Account ".concat(n.toLowerCase()))}return e.includes("verified")&&t.push("Email verified"),t.length>0?t.join(" â€¢ "):e}catch(t){return console.error("Error formatting details:",t),e}}(t);case"DELETE_USER":return"User account deleted";case"VERIFY_USER":return"User email verified";case"INVITE_USER":return"New user invited to platform";case"PASSWORD_RESET":return"Password reset requested";default:return t}}(e.action,e.details);o.append("\n            <tr>\n                <td>".concat(t,"</td>\n                <td><strong>").concat(e.user_name,"</strong><br><small>").concat(e.user_email,'</small></td>\n                <td><span class="action-badge ').concat(e.action.toLowerCase(),'">').concat(a,"</span></td>\n                <td>").concat(n,"</td>\n                <td><strong>").concat(e.performer_name,"</strong><br><small>").concat(e.performer_email,"</small></td>\n            </tr>\n        "))})):o.append('\n            <tr>\n                <td colspan="5" class="text-center">No audit logs found</td>\n            </tr>\n        '),a(e.total)},error:function(e){var t;n("Failed to load audit logs","error"),console.error("Error loading audit logs:",null===(t=e.responseJSON)||void 0===t?void 0:t.detail)}})}function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",a=$("<div>").addClass("notification ".concat(t)).text(e).appendTo("body");setTimeout((function(){return a.remove()}),3e3)}$(document).ready((function(){var a,i,r,s;r=localStorage.getItem("token"),s=localStorage.getItem("userRole"),r&&"admin"===s?$.ajax({url:"http://localhost:8000/api/auth/me",headers:{Authorization:"Bearer ".concat(r)},method:"GET",success:function(e){if("admin"!==e.role||!e.is_active)return localStorage.clear(),void(window.location.href="../auth/login.html");$("#adminName").text(e.name)},error:function(e){var t;401===e.status||403===e.status?(localStorage.clear(),window.location.href="../auth/login.html"):console.error("Error checking admin access:",null===(t=e.responseJSON)||void 0===t?void 0:t.detail)}}):window.location.href="../auth/login.html",t(),o(),$(".nav-links a").click((function(e){e.preventDefault();var t=$(this).attr("href").substring(1);"overview"!==t&&window.destroyAllCharts&&destroyAllCharts(),$(".admin-section").fadeOut(150,(function(){$(".admin-section").hide(),$("#".concat(t)).fadeIn(150),"overview"===t&&setTimeout(loadAllAnalytics,200)})),$(".nav-links li").removeClass("active"),$(this).parent().addClass("active")})),"audit"===targetId?o():"users"===targetId?t():"settings"===targetId&&loadAdminSettings(),$(".nav-links a").click((function(e){e.preventDefault();var a=$(this).attr("href").substring(1);$(".admin-section").removeClass("active").hide(),$("#".concat(a)).addClass("active").show(),$(".nav-links li").removeClass("active"),$(this).parent().addClass("active"),"overview"===a?loadAllAnalytics():"users"===a?t():"audit"===a&&o()})),$("#registrationTimeRange").on("change",(function(e){loadRegistrationTrends(parseInt($(this).val()))})),$(".admin-section").removeClass("active").hide(),$(".modal").hide(),$("#overview").addClass("active").show(),$(".nav-links li").removeClass("active"),$(".nav-links li:first-child").addClass("active"),$("#userSearch").on("input",(a=function(){return t(1)},function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];clearTimeout(i),i=setTimeout((function(){clearTimeout(i),a.apply(void 0,t)}),300)})),$("#roleFilter, #statusFilter").on("change",(function(){return t(1)})),$("#users").addClass("active").show(),$(".nav-links li:first-child").addClass("active"),$(".admin-section:not(#users)").removeClass("active").hide(),$(".modal").click((function(e){$(e.target).is(".modal")&&$(this).hide()})),$("#inviteForm").on("submit",(function(e){var a,o;e.preventDefault(),a=localStorage.getItem("token"),o={email:$("#inviteEmail").val(),name:$("#inviteName").val(),role:$("#inviteRole").val()},$.ajax({url:"http://localhost:8000/api/admin/invite/",headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},method:"POST",data:JSON.stringify(o),success:function(e){$("#inviteModal .modal-content .success-message").remove(),$('<p class="success-message">Invitation sent successfully!</p>').css({color:"#28a745","font-weight":"bold","margin-top":"10px","text-align":"center"}).appendTo("#inviteModal .modal-content"),$("#inviteForm")[0].reset(),t(),setTimeout((function(){$("#inviteModal").hide(),$("#inviteModal .modal-content .success-message").remove()}),2e3)},error:function(e){var t;n((null===(t=e.responseJSON)||void 0===t?void 0:t.detail)||"Failed to invite user","error")}})})),$("#editForm").on("submit",(function(e){e.preventDefault(),updateUser()})),$("#editUserModal .btn-secondary").click((function(){$("#editUserModal").hide()})),$("#prevPage").click((function(){e>1&&(e--,t())})),$("#nextPage").click((function(){e++,t()})),t(),$("#prevPage").click((function(){e>1&&(e--,o())})),$("#nextPage").click((function(){e++,o()})),o()}))},262:()=>{},342:()=>{var e=null,t=null,a=null,o=null,n=null;function i(){[e,t,a,o,n].forEach((function(e){e&&e.destroy()}))}function r(){i(),setTimeout((function(){var i;!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=localStorage.getItem("token");console.log("Loading registration trends..."),$.ajax({url:"http://localhost:8000/api/analytics/registration-trends?days=".concat(e),headers:{Authorization:"Bearer ".concat(t)},method:"GET",success:function(e){console.log("Registration trends data:",e),$("#trendsDebug").text(JSON.stringify(e,null,2));var t=document.getElementById("registrationTrendsChart").getContext("2d");n&&n.destroy();var a=e.dates.map((function(e){return new Date(e).toLocaleDateString()}));n=new Chart(t,{type:"line",data:{labels:a,datasets:[{label:"New Registrations",data:e.counts,borderColor:"#2196F3",backgroundColor:"rgba(33, 150, 243, 0.1)",tension:.4,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"User Registration Trends"}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}})},error:function(e){var t;console.error("Failed to load registration trends:",e),showNotification("Failed to load registration trends","error"),$("#trendsDebug").text("Error: "+((null===(t=e.responseJSON)||void 0===t?void 0:t.detail)||"Failed to fetch data"))}})}(),i=localStorage.getItem("token"),$.ajax({url:"http://localhost:8000/api/analytics/active-users",headers:{Authorization:"Bearer ".concat(i)},method:"GET",success:function(t){$("#totalUsers").text(t.total_users),$("#activeUsers").text(t.active_users),$("#verifiedUsers").text(t.verified_users);var a=document.getElementById("userDistributionChart").getContext("2d");e&&e.destroy(),e=new Chart(a,{type:"doughnut",data:{labels:["Active","Inactive"],datasets:[{data:[t.active_users,t.inactive_users],backgroundColor:["rgba(75, 192, 192, 0.8)","rgba(255, 99, 132, 0.8)"],borderColor:["rgba(75, 192, 192, 1)","rgba(255, 99, 132, 1)"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})},error:function(e){console.error("Failed to load active users:",e),showNotification("Failed to load active users metrics","error")}}),function(){var e=localStorage.getItem("token");$.ajax({url:"http://localhost:8000/api/analytics/login-activity",headers:{Authorization:"Bearer ".concat(e)},method:"GET",success:function(e){var t=document.getElementById("loginActivityChart").getContext("2d");a&&a.destroy(),a=new Chart(t,{type:"line",data:{labels:e.dates.map((function(e){return new Date(e).toLocaleDateString()})),datasets:[{label:"Daily Logins",data:e.counts,borderColor:"#4CAF50",backgroundColor:"rgba(76, 175, 80, 0.1)",tension:.4,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{boxWidth:12,padding:15}}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}});var n=document.getElementById("loginSuccessChart").getContext("2d");o&&o.destroy(),o=new Chart(n,{type:"doughnut",data:{labels:["Successful","Failed"],datasets:[{data:[e.total_success,e.total_failed],backgroundColor:["rgba(76, 175, 80, 0.8)","rgba(244, 67, 54, 0.8)"],borderColor:["rgba(76, 175, 80, 1)","rgba(244, 67, 54, 1)"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{boxWidth:12,padding:15}}}}});var i=$(".failure-list"),r=$(".ip-list");i.empty(),r.empty(),e.recent_failures&&e.recent_failures.length>0?e.recent_failures.forEach((function(e){var t=new Date(e.timestamp).toLocaleString();i.append("\n                        <li>\n                            <span>".concat(t,"</span>\n                            <span>").concat(e.ip_address,"</span>\n                        </li>\n                    "))})):i.append("<li>No recent failed attempts</li>"),e.suspicious_ips&&e.suspicious_ips.length>0?e.suspicious_ips.forEach((function(e){r.append('\n                        <li class="suspicious-ip">\n                            <span>'.concat(e.ip,"</span>\n                            <span>").concat(e.failure_count," attempts</span>\n                        </li>\n                    "))})):r.append("<li>No suspicious IP activity</li>")},error:function(e){console.error("Failed to load login activity:",e),showNotification("Failed to load login activity","error"),$(".failure-list").html("<li>Failed to load data</li>"),$(".ip-list").html("<li>Failed to load data</li>")}})}(),function(){var e=localStorage.getItem("token");$.ajax({url:"http://localhost:8000/api/analytics/role-distribution",headers:{Authorization:"Bearer ".concat(e)},method:"GET",success:function(e){var a=document.getElementById("roleDistributionChart").getContext("2d");t&&t.destroy(),t=new Chart(a,{type:"pie",data:{labels:e.roles.map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})),datasets:[{data:e.counts,backgroundColor:["rgba(54, 162, 235, 0.8)","rgba(255, 206, 86, 0.8)","rgba(75, 192, 192, 0.8)"],borderColor:["rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:10,boxWidth:12}}}}})},error:function(e){console.error("Failed to load role distribution:",e),showNotification("Failed to load role distribution","error")}})}()}),50)}$(document).ready((function(){$("#overview").is(":visible")&&(r(),setInterval((function(){$("#overview").is(":visible")&&r()}),3e4))})),window.loadAllAnalytics=r,window.destroyAllCharts=i}},t={};function a(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,a),i.exports}(()=>{"use strict";var e=a(262);function t(){var t=localStorage.getItem("token");localStorage.getItem("userRole"),t?$.ajax({url:"".concat(e.apiConfig.apiUrl,"/auth/check-session"),headers:{Authorization:"Bearer ".concat(t)},method:"GET",success:function(e){e.valid&&e.is_active?"admin"===e.role&&currentPath.includes("/pages/")?window.location.href="/salesoptimizer/admin/dashboard.html":"admin"!==e.role&&currentPath.includes("/admin/")&&(window.location.href="/salesoptimizer/pages/dashboard.html"):o()},error:function(){o()}}):o()}function o(){localStorage.clear(),window.location.href="/salesoptimizer/auth/login.html"}$(document).ready((function(){$("#errorMessage"),$("#loginForm").submit((function(t){t.preventDefault(),console.log("Attempting login to:",e.apiConfig.apiUrl),$.ajax({url:"".concat(e.apiConfig.apiUrl,"/auth/login/"),method:"POST",contentType:"application/json",xhrFields:{withCredentials:!1},headers:{Accept:"*/*","Content-Type":"application/json"},data:JSON.stringify({email:$("#email").val(),password:$("#password").val()}),success:function(e){console.log("Login response:",e),localStorage.setItem("token",e.access_token),localStorage.setItem("userName",e.name),localStorage.setItem("userRole",e.role),"admin"===e.role?window.location.href="../admin/dashboard.html":window.location.href="../dashboard.html"},error:function(e){var t;console.error("Login error details:",e),$("#errorMessage").text((null===(t=e.responseJSON)||void 0===t?void 0:t.detail)||"Login failed").addClass("show")}})}))})),a(342),a(137),t(),setInterval(t,6e4),a(16)})()})();